#!/bin/bash

echo "+---------------+"
echo "| Outdated gems |"
echo "+---------------+"
echo -e "\033[1;35m`bundle outdated --parseable`\033[0m"
yarn outdated

set -e

echo "+-----------------+"
echo "| Pushing develop |"
echo "+-----------------+"
git co develop
git push

echo "+-------------------+"
echo "| Running the tests |"
echo "+-------------------+"
rspec --profile
yarn test --single-run

echo "+--------------------------------+"
echo "| Switching to the master branch |"
echo "+--------------------------------+"
git co master
git merge --no-ff -m 'Merging develop into master' develop
git tag `ruby ./bin/version.rb`
git push
git push --tags

echo "+---------------------+"
echo "| Deploying to Heroku |"
echo "+---------------------+"
git push heroku master
heroku run rake db:migrate db:seed


git co develop
